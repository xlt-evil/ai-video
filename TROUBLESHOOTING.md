# 🔧 故障排查指南

## 问题 1: "Failed to fetch" 错误

### 症状
```
❌ 视频生成失败
错误信息: Failed to fetch
```

### 原因
浏览器无法直接访问火山引擎 API（CORS 跨域限制）

### 解决方案 ✅
项目已经配置了 API 代理路由，请确保：

1. **重启开发服务器**
   ```bash
   # 按 Ctrl+C 停止当前服务器
   # 然后重新启动
   npm run dev
   ```

2. **检查 API 路由**
   - 访问 http://localhost:3000/api/video/create 应该返回错误（这是正常的，因为没有发送数据）
   - 如果显示 404，说明 API 路由没有正确加载

3. **清除浏览器缓存**
   - 按 F12 打开开发者工具
   - 右键点击刷新按钮，选择"清空缓存并硬性重新加载"

## 问题 2: API Key 配置错误

### 症状
```
❌ 请先在设置中配置 API Key
```

### 解决方案
1. 点击左下角 ⚙️ 设置按钮
2. 在"基础配置"中填入您的 API Key
3. 点击"💾 保存配置"按钮
4. 确认页面顶部显示"✓ 配置完整"

### 验证配置
打开浏览器控制台（F12），输入：
```javascript
localStorage.getItem('ark_config')
```

应该显示您的配置 JSON，包含 apiKey 字段。

## 问题 3: 视频生成超时

### 症状
长时间显示"生成中..."，最终超时

### 原因
- 视频生成是 AI 密集型任务，通常需要 1-5 分钟
- 复杂场景或高分辨率需要更长时间

### 解决方案
1. **调整超时时间**
   - 打开设置 → 高级配置
   - 将"请求超时"从 300000ms (5分钟) 增加到 600000ms (10分钟)

2. **优化参数**
   - 降低分辨率（2K → 1080p → 720p）
   - 减少视频时长（10秒 → 5秒）
   - 简化提示词

3. **检查任务状态**
   打开浏览器控制台，查看日志：
   ```
   📊 任务状态: processing cgt-xxxxx
   ```

## 问题 4: API 返回错误代码

### 常见错误码

**400 Bad Request**
- 提示词格式不正确
- 缺少必要参数
- 参数值超出范围

**401 Unauthorized**
- API Key 无效或已过期
- 检查 API Key 是否正确复制

**403 Forbidden**
- 账户权限不足
- 该模型需要额外授权

**429 Too Many Requests**
- 请求频率过高
- 等待一段时间后重试

**500 Internal Server Error**
- 火山引擎服务器错误
- 稍后重试

## 问题 5: 无法看到视频

### 症状
显示"✅ 视频生成成功"，但没有播放器

### 解决方案
1. **检查浏览器控制台**
   - 按 F12 打开开发者工具
   - 查看是否有错误信息

2. **检查视频 URL**
   控制台应该显示：
   ```javascript
   ✅ 任务创建成功: { id: "cgt-xxx", ... }
   ```

3. **重新加载页面**
   - 按 F5 刷新页面
   - 视频 URL 可能已过期（通常 24 小时有效）

## 问题 6: 视频下载失败

### 症状
点击"下载视频"按钮没有反应

### 解决方案
1. **检查浏览器权限**
   - 允许网站下载文件
   - 检查浏览器下载设置

2. **使用"在新标签页打开"**
   - 点击"🔗 在新标签页打开"
   - 在新页面中右键另存为

3. **直接复制 URL**
   ```javascript
   // 在控制台中查看视频 URL
   console.log(result.content.video_url)
   ```

## 调试技巧

### 1. 开启详细日志

打开浏览器控制台（F12），您会看到详细的请求日志：

```
🚀 创建视频任务: { model: "...", prompt: "...", ... }
📡 响应状态: 200 OK
✅ 任务创建成功: { id: "cgt-xxx" }
📊 任务状态: processing cgt-xxx
📊 任务状态: succeeded cgt-xxx
```

### 2. 检查网络请求

1. 打开开发者工具（F12）
2. 切换到"Network"（网络）标签
3. 筛选 XHR/Fetch 请求
4. 查看请求和响应详情

### 3. 手动测试 API

在控制台中手动测试：

```javascript
// 测试创建任务
fetch('/api/video/create', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    apiKey: 'your_api_key',
    model: 'doubao-seedance-1-0-pro-250528',
    content: [{
      type: 'text',
      text: '测试视频 --resolution 720p --duration 3'
    }]
  })
})
.then(r => r.json())
.then(console.log)
```

### 4. 检查 API 路由状态

确认 API 路由正常工作：

```bash
# 在终端中查看是否有 API 路由日志
# 应该显示类似：
# 🚀 代理创建视频任务: { endpoint: "...", model: "..." }
```

## 常见问题 FAQ

### Q: 支持哪些视频格式？
A: 目前只支持 MP4 格式。

### Q: 视频最长可以多久？
A: 1-10 秒。

### Q: 可以同时生成多个视频吗？
A: 建议串行生成，避免并发限制。

### Q: 生成的视频有水印吗？
A: 可以在设置中选择是否添加水印。

### Q: 视频 URL 有效期多久？
A: 通常为 24 小时，建议及时下载。

### Q: 如何提高生成速度？
A: 
- 使用较低分辨率（720p）
- 减少视频时长（3-5秒）
- 简化提示词

### Q: 提示词有字数限制吗？
A: 建议控制在 200 字以内，过长可能被截断。

## 获取帮助

如果以上方法都无法解决问题：

1. **查看完整文档**
   - [QUICKSTART.md](./QUICKSTART.md)
   - [VIDEO_GENERATION_GUIDE.md](./docs/VIDEO_GENERATION_GUIDE.md)
   - [README.md](./README.md)

2. **检查官方文档**
   - [火山引擎视频生成 API](https://www.volcengine.com/docs/82379/1520757)
   - [查询任务状态](https://www.volcengine.com/docs/82379/1521309)

3. **联系技术支持**
   - 火山引擎官方客服
   - 提交工单说明问题

4. **社区求助**
   - 提供完整的错误信息
   - 附上浏览器控制台日志
   - 说明您的环境（浏览器、系统等）

---

**希望这个指南能帮助您解决问题！🎯**

